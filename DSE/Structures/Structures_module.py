from numpy import*
from matplotlib import pyplot as plt
from numpy.linalg import inv

#%% ------------- Input ------------------
# I have just copied this for now, I will clean it up by importing the txt file later
#Cl = array([0.45401197, 0.59314027, 0.67983843, 0.73606313, 0.77251623, 0.80735009,
# 0.8353416,  0.86410226, 0.8862658,  0.91311351, 0.93534546, 0.96534544,
# 1.01009516, 0.93205674, 0.99882457, 1.05348972, 1.10355137, 1.14644941,
# 1.18648774, 1.22565622, 1.24058785, 1.26768158, 1.27972376, 1.28495111,
# 1.27576291, 1.22487137, 1.10590927, 1.10590927, 1.22487137, 1.27576291,
# 1.28495111, 1.27972376, 1.26768158, 1.24058785, 1.22565622, 1.18648774,
# 1.14644941, 1.10355137, 1.05348972, 0.99882457, 0.93205674, 1.01009516,
# 0.96534544, 0.93534546, 0.91311351, 0.8862658,  0.86410226, 0.8353416,
# 0.80735009, 0.77251623, 0.73606313, 0.67983843, 0.59314027, 0.45401197]);
#span_location = array([-24.35585, -23.84732, -23.33879, -22.83026, -22.32173, -21.8132,  -21.30466,
# -20.79613, -20.28759, -19.77905, -19.27052, -18.76198, -18.25344, -17.35214,
# -16.06664, -14.78112, -13.49558, -12.21003, -10.92447,  -9.6389,   -8.35332,
#  -7.06773,  -5.78213,  -4.49653,  -3.21092,  -1.9253,   -0.63968,   0.63968,
#   1.9253,    3.21092,   4.49653,   5.78213,   7.06773,   8.35332,   9.6389,
#  10.92447,  12.21003,  13.49558,  14.78112,  16.06664,  17.35214,  18.25344,
#  18.76198,  19.27052,  19.77905,  20.28759,  20.79613,  21.30466,  21.8132,
#  22.32173,  22.83026,  23.33879,  23.84732,  24.35585]);
dir = "liftdistribution.txt";
data = genfromtxt(dir);
Cl = data[1, :];
span_location = data[0, :];

#%% ------------ Functions -----------------
def monomial_basis(nodes, f):
	N = len(nodes);
	A = zeros((N, N));
	for i in range(N):
		A[:, i] = nodes**i;
	coeff = inv(A).dot(f);
	print(coeff);
	return coeff;

def reconstruct_f(coeff, plot_nodes):
	F = 0;
	for i in range(len(coeff)):
		F += coeff[i]*plot_nodes**i;
	return F;



coeff = monomial_basis(span_location[::2], Cl[::2]);
coeff = coeff[::-1]
F = reconstruct_f(coeff, span_location);
plt.plot(span_location, Cl, "x");
plt.plot(span_location, F);
plt.grid(True);
plt.show();

#%%------------Bending Moment Equation---------------------------
from sympy import Symbol, Poly
print(coeff)
#print(F)
x = Symbol('x')
V = Poly(F, x)
#print(V)

def p(x):
    return 0.454011649359018*x**53 + 0.0616389823844656*x**52 + 0.679838278214447*x**51 + 0.801104528567521*x**50 + 0.772516148106661*x**49 + 0.788736176618841*x**48 + 0.83534154517838*x**47 + 0.86933961453542*x**46 + 0.886265753466432*x**45 + 0.904247192435832*x**44 + 0.935345424271873*x**43 + 0.975251719788503*x**42 + 1.0100951142922*x**41 + 1.02889351448272*x**40 + 0.998824527990525*x**39 + 1.02687404648705*x**38 + 1.10355132813015*x**37 + 1.15512865744839*x**36 + 1.18648768204066*x**35 + 1.21918172181714*x**34 + 1.24058777563697*x**33 + 1.25277490023118*x**32 + 1.27972369022915*x**31 + 1.30597546850347*x**30 + 1.27576284226333*x**29 + 1.18175333118522*x**28 + 1.10590920503108*x**27 + 1.12883501939202*x**26 + 1.22487130708441*x**25 + 1.29234785055968*x**24 + 1.28495103927901*x**23 + 1.25852833182955*x**22 + 1.26768148686125*x**21 + 1.27554224438953*x**20 + 1.22565611643471*x**19 + 1.15750707850042*x**18 + 1.14644930353169*x**17 + 1.14688311870869*x**16 + 1.05348960496926*x**15 + 0.931315990703869*x**14 + 0.932056641768838*x**13 + 0.966600950786642*x**12 + 0.965345348225128*x**11 + 0.944357195528937*x**10 + 0.913113407886158*x**9 + 0.884734471841512*x**8 + 0.864102148563688*x**7 + 0.842259308039502*x**6 + 0.807349961716682*x**5 + 0.765705127385445*x**4 + 0.736062968120677*x**3 + 0.68526835530065*x**2 + 0.593140038079582*x + 1.73578770365566

#print(p(-10))
#p = Polynomial()
def V1(t):
    return (9*t**2 - 103.72*t)


